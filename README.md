# OTUS. Занятие 9 - Bash

Задание
```
Пишем скрипт
написать скрипт для крона который раз в час присылает на заданную почту
- X IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- Y запрашиваемых адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- все ошибки c момента последнего запуска
- список всех кодов возврата с указанием их кол-ва с момента последнего запуска в письме должно быть прописан обрабатываемый временной диапазон должна быть реализована защита от мультизапуска
Критерии оценки:
трапы и функции, а также sed и find +1 балл
```

## ЗАПУСК

> vagrant up

> vagrant ssh

### Описание

- Для эмуляции пополнения лога используется расписание.
В систему в папку /home/vagrant копируется выданный в качестве задания лог с именем access-template.log и обрабатываемый скриптом файл access.log , который изначально содержит первые 60 строк access-template.log. По расписанию cron каждую минуту с помощью скрипта increment_line.sh в файл access.log добавляется очередная строка из access-template.log 

- Анализ лога производится скриптом make_report.sh, который запускается по cron в 0 минут каждого часа.

В скрипте используются переменные:
- X (количество анализируемых IP адресов)
- Y (количество анализируемых запросов)
- last_line (номер последней проанализированной строки при прошлом запуске)

Реализована защита от повторного запуска с помощью анализа lockfile=/tmp/lockfile

Скрипт анализирует файл access.log начиная со строки, записанной в last_line и до последней на текущий момент. Составляет заданный отчет log_report.txt, обновляет значение последней строки в файл last_line.txt и отправляет отчет пользователю vagrant на почту.

Посмотреть почту можно командой 
>mail

Текущее количество строк в логе командой
>awk 'END {print NR}' access.log
